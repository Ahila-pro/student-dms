trigger:
- main

pool:
  name: stud-sh-pool  # ðŸ‘ˆ Your self-hosted Windows agent pool name

variables:
  phpVersion: 8.2
  packagePath: '$(Build.ArtifactStagingDirectory)\app.zip'

steps:
# âœ… Checkout code




# âœ… Archive Laravel app
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.SourcesDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(packagePath)'
    replaceExistingArchive: true
  displayName: 'Archive PHP App'

# âœ… Publish artifact to pipeline
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'
  displayName: 'Publish Artifact'

# âœ… Deploy to Azure Linux App Service
- task: AzureRmWebAppDeployment@5
  displayName: 'Deploy to Azure Linux App Service'
  inputs:
    ConnectionType: 'AzureRM'
    azureSubscription: 'Azure subscription 1(1)(8ca97cad-9ab1-42a2-9d9e-bdbf8876c147)'         # ðŸ‘ˆ Update this
    appType: 'webAppLinux'                                      # ðŸ‘ˆ IMPORTANT: must be Linux
    WebAppName: 'studdmsstatic'                           # ðŸ‘ˆ Update this
    deployToSlotOrASE: true
    ResourceGroupName: 'rgp-devops'                 # ðŸ‘ˆ Update this
    SlotName: 'production'
    packageForLinux: '$(packagePath)'                           # ðŸ‘ˆ Use `packageForLinux` here
    RuntimeStack: 'PHP|8.2'                                     # ðŸ‘ˆ Linux runtime (App Service Plan)
    StartupCommand: ''
    DeploymentTypeLinux: 'oneDeploy'
